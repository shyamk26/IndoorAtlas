<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="Content-Type" content="html/html; charset=utf-8" />
		<title>3. Positioning Document</title>
		<meta id="xcode-display" name="xcode-display" content="render"/>
		<link rel="stylesheet" type="text/css" href="../css/styles.css" media="all" />
		<link rel="stylesheet" type="text/css" media="print" href="../css/stylesPrint.css" />	
		<meta name="generator" content="appledoc 2.2 (build 963)" />
	<link rel='shortcut icon' type='image/x-icon' href='data:image/x-icon;base64,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' /></head>
	<body>
		<header id="top_header">
			<div id="library" class="hideInXcode">
				<h1><a id="libraryTitle" href="../index.html">IndoorAtlas iOS SDK (1.4.1-beta) </a></h1>
				<a id="developerHome" href="../index.html">IndoorAtlas</a>
			</div>
			
			<div id="title" role="banner">
				<h1 class="hideInXcode" id="pageTitleHeader">3. Positioning Document</h1>
			</div>
			<ul id="headerButtons" role="toolbar"></ul>
		</header>
		<article>
			<a title="3. Positioning Document" name="top"></a>
			<div id="overview_contents" role="main">
				<div id="container">	
					<h1>Positioning</h1>

<p>Indoor positioning functionality is provided through <a href="../Classes/IndoorAtlasPositioner.html">IndoorAtlasPositioner</a> class.</p>

<h2>Instancing positioner</h2>

<p>Positioner instances can be requested for floor plan instances from class method <a href="../Classes/IndoorAtlas.html#//api/name/positionerForFloorplan:">[IndoorAtlas positionerForFloorplan:]</a>.</p>

<pre><code>[IndoorAtlas setApiKey:@"api-key" andSecret:@"api-secret"];

[IndoorAtlas fetchFloorplanWithId:@"id-of-the-floor-plan" completion:^(IndoorAtlasFloorplan *floorplan, NSError *error) {
    if (error)
        return;

    IndoorAtlasPositioner *positioner;
    positioner = [IndoorAtlas positionerForFloorplan:floorplan];
}];
</code></pre>

<h2>Starting positioner</h2>

<p>Each positioner is bound to one floor plan.</p>

<p>Positioners may be <strong>connected</strong>, <strong>prepared</strong>, <strong>started</strong>, and <strong>stopped</strong> manually. These methods trigger state changes through a delegate.</p>

<pre><code>// Connect to positioning service, do nothing else.
[positioner connect];

// Tell service to prepare the positioning session.
// This will automatically call connect, if not called before.
[positioner prepare];

// Session may also be prepared with parameters
IndoorAtlasPositionerParameters *params = [IndoorAtlasPositionerParameters new];

// For example, set shopping cart motion mode
// params.motionMode = @"shopping_cart";

[positioner prepareWithParameters:params]

// Start positioning
// This will call prepare automatically, if not called before.
[positioner start];

// You may also start with parameters.
// These parameters are same as for prepare, and ignore if prepare or prepareWithParameters: is called before.
// Only use this method, if you don't explicitly have need to prepare session before.
[positioner startWithParameters:params];

// Disconnect from service.
[positioner stop];
</code></pre>

<h2>Going background</h2>

<p>iOS will keep reading sensors when application is in background state during positioning.
This helps SDK to find location faster when application enters foreground.</p>

<p>If you do not need positioning during background state, it is recommended to stop positioning before to save battery.</p>

<h2>Explicit position</h2>

<p>Set explicit position using the <a href="../Classes/IndoorAtlasPositioner.html">IndoorAtlasPositioner</a> instance.
Setting explicit position causes started positioner instances to converge at the given location.
Connected but not yet started positioner instances will use the given location as a starting position.</p>

<p>Explicit position allows you to utilize external position data, for example beacons, with IndoorAtlas indoor positioning technology.</p>

<pre><code>// Submits explicit metric position (x: 7.5, y: 14.6) from the upper left corner of the floor plan with radius of 3 meters
[positioner submitExplicitMetricPosition:(IndoorAtlasPoint){ 7.5, 14.6 } withRadius:3.0];

// Submits explicit pixel position (x: 320 y: 120) with radius of 25 pixels
[positioner submitExplicitPixelPosition:(IndoorAtlasPixel){ 320, 120 } withRadius:25];
</code></pre>

<h2>Position updates</h2>

<p>Implement the <a href="../Protocols/IndoorAtlasPositionerDelegate.html">IndoorAtlasPositionerDelegate</a> to get events from the positioner.</p>

<p>Position updates are received through <a href="../Protocols/IndoorAtlasPositionerDelegate.html#//api/name/indoorAtlasPositioner:positionChanged:">[IndoorAtlasPositionerDelegate indoorAtlasPositioner:positionChanged:]</a> method.
The <a href="../Classes/IndoorAtlasPosition.html">IndoorAtlasPosition</a> instance received by this method contains the WGS84, metric and pixel coordinates, course information and uncertainty radius.</p>

<pre><code>- (void)indoorAtlasPositioner:(IndoorAtlasPositioner*)positioner positionChanged:(IndoorAtlasPosition*)position
{
    // Latency is only calculated during positioning
    NSLog(@"Latency: %.2f", positioner.latency);
    NSLog(@"Position pixel point: %dx%d", position.pixelPoint.x, position.pixelPoint.y);
    NSLog(@"Position metric point: %f, %f", position.metricPoint.x, position.metricPoint.y);
    NSLog(@"Position coordinate (lat: %f lon: %f)", position.coordinate.latitude, position.coordinate.longitude);
    NSLog(@"Uncertainty radius (%f meters)", position.radius);
    NSLog(@"Course (%f)", position.course);
}
</code></pre>

<p><img src="xy.png" alt="Metric and pixel coordinates are from top left to bottom right" /></p>

<p>Metric and pixel coordinates in <a href="../Classes/IndoorAtlasPosition.html">IndoorAtlasPosition</a> instance are from top left to bottom right.
This means the (0, 0) would be the top left of the floor plan image.</p>

<h2>Switching floor plans</h2>

<p>Use multiple <a href="../Classes/IndoorAtlasPositioner.html">IndoorAtlasPositioner</a> instances to switch between floor plans.</p>

<pre><code>// Create 2 positioner instances for both floor plans
IndoorAtlasPositioner *positioner1 = [IndoorAtlas positionerForFloorplan:@"floor-plan-id-1"];
IndoorAtlasPositioner *positioner2 = [IndoorAtlas positionerForFloorplan:@"floor-plan-id-2"];

/ Start first positioner instance
[positioner1 start];

// When switching floor plan, stop the running instance and start the another
[positioner1 stop];
[positioner2 start];

// Switch back to the first positioner
[positioner2 stop];
[positioner1 start];
</code></pre>

<h2>State changes</h2>

<p>Positioner state changes emit <a href="../Protocols/IndoorAtlasPositionerDelegate.html#//api/name/indoorAtlasPositioner:stateChanged:">[IndoorAtlasPositionerDelegate indoorAtlasPositioner:stateChanged:]</a> method.
State changes indicate the state of session and possible connection problems.</p>

<pre><code>- (void)indoorAtlasPositioner:(IndoorAtlasPositioner*)positioner stateChanged:(IndoorAtlasPositioningState)state
{
    switch (state) {
        default:
            // See the constants and documentation in IndoorAtlasPositioner.h
            // Also check the state diagram below.
            NSLog(@"State changed");
            break;
    }
}
</code></pre>

<p>The state diagram below outlines the state changes:</p>

<p><img src="PositioningStates.png" alt="State diagram of possible states from positioner instance" /></p>
				</div>
				<div id="footer">
					<hr />
					<div class="footer-copyright">
						<p><span class="copyright">&copy; 2015 IndoorAtlas. All rights reserved. (Last updated: 2015-04-14)</span><br />
						
						<span class="generator">Generated by <a href="http://appledoc.gentlebytes.com">appledoc 2.2 (build 963)</a>.</span></p>
						
					
					</div>
				</div>
			</div>
		</article>
	</body>
</html>
